<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById("currentDate").value = today;
        });

        // Function to collect form data and send it as JSON
        function collectFormData() {
            const formData = {
                artNum: document.getElementById("artNum").value,
                quantityForOrder: document.getElementById("quantityForOrder").value,
                orderBy: document.getElementById("orderBy").value,
                date: document.getElementById("currentDate").value,
                orderReason: document.getElementById("orderReason").value,
                comment: document.getElementById("comment").value
            };
            return formData;
        }

        // Function to send data to the backend using fetch
        function sendFormData() {
            const formData = collectFormData();
            fetch("/orders/preOrder", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                alert("Order Added Successfully!");
                // Optionally, you can redirect or update the page
                // window.location.href = '/orders/preOrder'; // Uncomment to reload the page
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to add order');
            });
        }

        // Function to handle the update action for editable rows
        function updateArticle(id) {
            const rowData = {
                id: id,
                artNum: document.getElementById(`artNum-${id}`).value,
                quantityForOrder: document.getElementById(`quantityForOrder-${id}`).value,
                orderBy: document.getElementById(`orderBy-${id}`).value,
                date: document.getElementById(`date-${id}`).value,
                orderReason: document.getElementById(`orderReason-${id}`).value,
                comment: document.getElementById(`comment-${id}`).value
            };

            fetch(`/orders/updatePreOrder/${id}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(rowData)
            })
            .then(response => response.json())
            .then(data => {
                alert("Order Updated Successfully!");
                // Optionally, you can reload the page or refresh the table data
                // window.location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to update order');
            });
        }
    </script>
</head>
<body>
<div th:replace="~{fragments/navbar::navbar(activeLink=${'home'})}"></div>
<div class="container">
    <h1>PreOrder</h1>

    <!-- Form to Add a New PreOrder -->
    <div class="add-container">
        <label for="artNum">Article:</label>
        <input type="text" id="artNum" required><br>
        <label for="quantityForOrder">Quantity:</label>
        <input type="number" id="quantityForOrder" required><br>
        <label for="orderBy">Order by:</label>
        <input type="text" id="orderBy" required><br>
        <label for="currentDate">Date:</label>
        <input type="date" id="currentDate" required><br>
        <label for="orderReason">Order reason:</label>
        <input type="text" id="orderReason"><br>
        <label for="comment">Comments:</label>
        <input type="text" id="comment"><br>
        <button type="button" onclick="sendFormData()">Add Order</button>
    </div>

    <!-- Table to display existing orders with editable fields -->
    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Article</th>
            <th>Quantity</th>
            <th>Ordered by</th>
            <th>Date</th>
            <th>Order reason</th>
            <th>Comment</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="article : ${allArticle}">
            <td th:text="*{id}"></td>
            <td><input type="text" id="artNum-*{id}" th:value="*{artNum}" /></td>
            <td><input type="number" id="quantityForOrder-*{id}" th:value="*{quantityForOrder}" /></td>
            <td><input type="text" id="orderBy-*{id}" th:value="*{orderBy}" /></td>
            <td><input type="date" id="date-*{id}" th:value="*{date}" /></td>
            <td><input type="text" id="orderReason-*{id}" th:value="*{orderReason}" /></td>
            <td><input type="text" id="comment-*{id}" th:value="*{comment}" /></td>
            <td><button type="button" onclick="updateArticle(*{id})">Update</button></td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
